apache:
  image: eeacms/apache:2.4s
  links:
    - haproxy
  ports:
    - "7070:80"
  env_file:
    - apache.env
  volumes:
    - /etc/localtime:/etc/localtime:ro
#  log_driver: "gelf"
#  log_opt:
#    address: "udp://swarm01-eeasites.eea.europa.eu:12201"
  restart: always

haproxy:
  image: eeacms/haproxy:1.6
  links:
    - www1
    - www2
  volumes:
    - /etc/localtime:/etc/localtime:ro
#  log_driver: "gelf"
#  log_opt:
#    address: "udp://swarm01-eeasites.eea.europa.eu:12201"
  restart: always
  environment:
    - BACKENDS=www1:80 www2:80

www1:
  image: eeacms/cynin
  volumes_from:
    - data
  links:
    - zeo
    - postfix
  command: bin/www1 console
  volumes:
    - /etc/localtime:/etc/localtime:ro
#  log_driver: "gelf"
#  log_opt:
#    address: "udp://swarm01-eeasites.eea.europa.eu:12201"
  restart: always

www2:
  image: eeacms/cynin
  volumes_from:
    - data
  links:
    - zeo
    - postfix
  command: bin/www1 console
  volumes:
    - /etc/localtime:/etc/localtime:ro
#  log_driver: "gelf"
#  log_opt:
#    address: "udp://swarm01-eeasites.eea.europa.eu:12201"
  restart: always

zeo:
  image: eeacms/cynin
  volumes_from:
    - data
  command: bin/zeoserver fg
  volumes:
    - /etc/localtime:/etc/localtime:ro
#  log_driver: "gelf"
#  log_opt:
#    address: "udp://swarm01-eeasites.eea.europa.eu:12201"
  restart: always

postfix:
  image: eeacms/postfix:eionet
  volumes:
    - /etc/localtime:/etc/localtime:ro
  env_file:
    - .postfix.secret
  volumes:
    - /etc/localtime:/etc/localtime:ro
#  log_driver: "gelf"
#  log_opt:
#    address: "udp://swarm01-eeasites.eea.europa.eu:12201"
  restart: always

data:
  build: data
  volumes:
    - /var/local/community.eea.europa.eu/var/filestorage
    - /var/local/community.eea.europa.eu/var/blobstorage
